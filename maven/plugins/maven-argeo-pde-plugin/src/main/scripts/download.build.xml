<project default="eclipseBuildDir">

	<target name="eclipseBuildDir">
		<fail message="Property eclipseBuildDir has to be set"
		      unless="eclipseBuildDir" />

		<property name="downloadsDir" location="${eclipseBuildDir}/download" />
		<mkdir dir="${downloadsDir}" />

		<!-- Base -->
		<doTar target="eclipse"
		       file="eclipse-SDK-3.3.2-linux-gtk.tar.gz"
		       url="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/eclipse/downloads/drops/R-3.3.2-200802211800/eclipse-SDK-3.3.2-linux-gtk.tar.gz" />
		<doZip target="eclipse"
		       file="eclipse-RCP-3.3.2-delta-pack.zip"
		       url="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/eclipse/downloads/drops/R-3.3.2-200802211800/eclipse-RCP-3.3.2-delta-pack.zip" />

		<!--
		<doZip target="eclipse" file="" url="" />
-->
		<!-- WTP -->
		<doZip target="pluginPath/eclipse-WTP-2.0.2"
		       file="wtp-R-2.0.2-20080223205547.zip"
		       url="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/webtools/downloads/drops/R2.0/R-2.0.2-20080223205547/wtp-R-2.0.2-20080223205547.zip" />
		<doZip target="pluginPath/eclipse-WTP-2.0.2"
		       file="emf-sdo-xsd-SDK-2.3.2.zip"
		       url="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/modeling/emf/emf/downloads/drops/2.3.2/R200802051830/emf-sdo-xsd-SDK-2.3.2.zip" />
		<doZip target="pluginPath/eclipse-WTP-2.0.2"
		       file="GEF-SDK-3.3.2.zip"
		       url="http://www.mirrorservice.org/sites/download.eclipse.org/eclipseMirror/tools/gef/downloads/drops/3.3.2/R200802211602/GEF-SDK-3.3.2.zip" />

		<doZip target="pluginPath/Spring-IDE-2.0.5"
		       file="spring-ide_2.0.5_v200805211800.zip"
		       url="http://s3browse.com/getObject/dist.springframework.org/release/IDE/spring-ide_2.0.5_v200805211800.zip" />

	</target>

	<macrodef name="doZip">
		<attribute name="url" />
		<attribute name="target" />
		<attribute name="file" default="download.zip" />
		<attribute name="downloadLocation"
		           default="${downloadsDir}/@{target}" />
		<attribute name="downloadFile" default="@{downloadLocation}/@{file}" />
		<sequential>
			<mkdir dir="@{downloadLocation}" />
			<retrieve url="@{url}" downloadfile="@{downloadFile}" />
			<mkdir dir="${eclipseBuildDir}/@{target}" />
			<unzip dest="${eclipseBuildDir}/@{target}" src="@{downloadFile}" />
			<removeEclipseDir dir="${eclipseBuildDir}/@{target}" />
		</sequential>
	</macrodef>

	<macrodef name="doTar">
		<attribute name="url" />
		<attribute name="target" />
		<attribute name="file" default="download.zip" />
		<attribute name="downloadLocation"
		           default="${downloadsDir}/@{target}" />
		<attribute name="downloadFile" default="@{downloadLocation}/@{file}" />
		<sequential>
			<mkdir dir="@{downloadLocation}" />
			<retrieve url="@{url}" downloadfile="@{downloadFile}" />
			<mkdir dir="${eclipseBuildDir}/@{target}" />
			<untar dest="${eclipseBuildDir}/@{target}"
			       src="@{downloadFile}"
			       compression="gzip" />
			<removeEclipseDir dir="${eclipseBuildDir}/@{target}" />
		</sequential>
	</macrodef>

	<macrodef name="retrieve">
		<attribute name="url" />
		<attribute name="downloadFile" />
		<sequential>
			<echo message="Download from URL @{url} to @{downloadFile}" />
			<get src="@{url}"
			     dest="@{downloadFile}"
			     verbose="true"
			     usetimestamp="true" />
		</sequential>
	</macrodef>

	<macrodef name="removeEclipseDir">
		<attribute name="dir" />
		<sequential>
			<echo message="Remove eclipse dir from @{dir} if present" />
			<move todir="@{dir}">
				<fileset dir="@{dir}">
					<include name="eclipse/plugins/**" />
					<include name="eclipse/features/**" />
				</fileset>
				<globmapper from="eclipse/*" to="*" />
			</move>
			<delete dir="@{dir}/eclipse" />
		</sequential>
	</macrodef>
</project>